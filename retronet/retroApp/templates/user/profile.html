{% extends "user_base.html" %}

<!-- Main Content Area -->
<div class="container">
    <div class="main-content">
        <!-- Left Column -->
        <div class="left-column">
            <!-- Profile Picture -->
            <div class="module">
                <div class="module-header">{{ user.username }}</div>
                <div class="module-content profile-pic">
                    <img src="{{ user.profile_pic or '/static/default-profile.png' }}" alt="{{ user.username }}">
                </div>
            </div>

            <!-- Music Player -->
            {% if user.profile_song %}
            <div class="module">
                <div class="module-header">Now Playing</div>
                <div class="module-content">
                    <div class="music-player">
                        <div style="margin-bottom: 5px;">{{ user.profile_song_title or 'Profile Song' }}</div>
                        <audio controls autoplay loop>
                            <source src="{{ user.profile_song }}" type="audio/mpeg">
                            Your browser doesn't support the audio element.
                        </audio>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Contact Box -->
            <div class="module">
                <div class="module-header">Contact {{ user.username }}</div>
                <div class="module-content">
                    <table class="contact-table">
                        <tr>
                            <td><a href="/message/{{ user.username }}" class="contact-btn">Send Message</a></td>
                            <td><a href="/stalk/{{ user.username }}" class="contact-btn">Stalk User</a></td>
                        </tr>
                        <tr>
                            <td><a href="/user/{{ user.username }}/pics" class="contact-btn">View Pics</a></td>
                            <td><a href="/user/{{ user.username }}/blog" class="contact-btn">View Blog</a></td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- User Details -->
            <div class="module">
                <div class="module-header">{{ user.username }}'s Details</div>
                <div class="module-content">
                    <ul class="details-list">
                        <li><strong>Status:</strong> {{ user.status or 'Online' }}</li>
                        {% if user.location %}
                        <li><strong>Location:</strong> {{ user.location }}</li>
                        {% endif %}
                        {% if user.age %}
                        <li><strong>Age:</strong> {{ user.age }}</li>
                        {% endif %}
                        {% if user.website %}
                        <li><strong>Website:</strong> <a href="{{ user.website }}">{{ user.website }}</a></li>
                        {% endif %}
                        <li><strong>Member Since:</strong> {{ user.created_at | date_format }}</li>
                    </ul>
                </div>
            </div>

            <!-- Stalkers (Top 8) -->
            <div class="module">
                <div class="module-header">{{ user.username }}'s Stalkers</div>
                <div class="module-content">
                    <div class="stalker-count">{{ user.stalker_count or 0 }} Stalkers</div>
                    <div class="stalkers-grid">
                        {% for stalker in user.stalkers[:8] %}
                        <div class="stalker-card">
                            <a href="/user/{{ stalker.username }}">
                                <img src="{{ stalker.profile_pic or '/static/default-profile.png' }}" alt="{{ stalker.username }}">
                                <div>{{ stalker.display_name or stalker.username }}</div>
                            </a>
                        </div>
                        {% else %}
                        <div style="grid-column: 1 / -1; text-align: center; color: #999;">
                            No stalkers yet!
                        </div>
                        {% endfor %}
                    </div>
                    {% if user.stalker_count > 8 %}
                    <div class="view-all">
                        <a href="/user/{{ user.username }}/stalkers">View All Stalkers</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
            <!-- About Me -->
            <div class="module">
                <div class="module-header">About Me:</div>
                <div class="module-content about-content">
                    {{ user.about_me or 'This user hasn\'t written anything about themselves yet.' | safe }}
                </div>
            </div>

            <!-- Recent Blog Posts -->
            <div class="module">
                <div class="module-header">{{ user.username }}'s Latest Blog Entry</div>
                <div class="module-content">
                    {% for post in user.recent_blog_posts[:3] %}
                    <div class="blog-post">
                        <div class="blog-title">{{ post.title }}</div>
                        <div class="blog-date">{{ post.created_at | datetime_format }}</div>
                        <div class="blog-content">{{ post.preview | safe }}</div>
                        <a href="/blog/{{ post.id }}" class="blog-link">[Read More]</a>
                    </div>
                    {% else %}
                    <div style="color: #999; text-align: center;">No blog posts yet.</div>
                    {% endfor %}
                    <div class="view-all">
                        <a href="/user/{{ user.username }}/blog">View All Blog Entries</a>
                    </div>
                </div>
            </div>

            <!-- Feed (Forums & Usenet) -->
            <div class="module">
                <div class="module-header">{{ user.username }}'s Feed</div>
                <div class="module-content">
                    {% for item in user.feed_items[:5] %}
                    <div class="feed-item">
                        <div class="feed-source">
                            {% if item.type == 'forum' %}
                            ðŸ“‹ Forum: {{ item.source }}
                            {% elif item.type == 'usenet' %}
                            ðŸ“° Usenet: {{ item.source }}
                            {% endif %}
                        </div>
                        <div class="feed-title">{{ item.title }}</div>
                        <div class="feed-preview">{{ item.preview }}</div>
                        <div class="blog-date">{{ item.created_at | datetime_format }}</div>
                    </div>
                    {% else %}
                    <div style="color: #999; text-align: center;">
                        No feed items. Subscribe to forums and Usenet groups to see content here!
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Comments Section -->
            <div class="module">
                <div class="module-header">{{ user.username }}'s Comments ({{ user.comment_count or 0 }})</div>
                <div class="module-content">
                    {% for comment in user.comments[:5] %}
                    <div class="comment">
                        <div class="comment-header">
                            <a href="/user/{{ comment.author.username }}">{{ comment.author.display_name or comment.author.username }}</a>
                            <span class="comment-date">{{ comment.created_at | datetime_format }}</span>
                        </div>
                        <div>{{ comment.content | safe }}</div>
                    </div>
                    {% else %}
                    <div style="color: #999; text-align: center;">No comments yet.</div>
                    {% endfor %}
                    
                    {% if current_user %}
                    <div class="comment-form" style="margin-top: 15px;">
                        <form action="/user/{{ user.username }}/comment" method="POST">
                            <textarea name="comment" rows="4" placeholder="Leave a comment..."></textarea>
                            <button type="submit">Post Comment</button>
                        </form>
                    </div>
                    {% endif %}
                    
                    {% if user.comment_count > 5 %}
                    <div class="view-all">
                        <a href="/user/{{ user.username }}/comments">View All Comments</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Auto-play music script -->
{% if user.profile_song %}
<script>
    // Try to autoplay (may be blocked by browser policies)
    document.addEventListener('DOMContentLoaded', function() {
        var audio = document.querySelector('audio');
        if (audio) {
            audio.play().catch(function(error) {
                console.log('Autoplay was prevented:', error);
            });
        }
    });
</script>
{% endif %}